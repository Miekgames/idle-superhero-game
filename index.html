<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Idle Superhero Tycoon game. Collect, upgrade, and assign heroes of different classes to missions!" />
  <title>Idle Superhero Tycoon</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --tech-color: #4fc3f7;
      --magic-color: #ba68c8;
      --strength-color: #ff7043;
      --speed-color: #aed581;
      --accent: #ffeb3b;
      --bg-main: #111;
      --bg-section: #1a1a1a;
      --bg-card: #23272f;
      --text-main: #fff;
      --shadow: 0 2px 8px 0 rgba(0,0,0,0.11);
    }
    body {
      background: var(--bg-main);
      color: var(--text-main);
      font-family: 'Montserrat', Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    main { max-width: 950px; margin: 0 auto; padding: 15px; }
    header { text-align: center; padding: 22px 0 10px 0; }
    h1,h2 { font-weight: 700; }
    section { background: var(--bg-section); margin: 14px 0; border-radius: 10px; padding: 18px; box-shadow: var(--shadow);}
    button, select {
      font-family: inherit;
      font-size: 1em;
      border-radius: 6px;
      border: none;
      outline: none;
      padding: 8px 18px;
      background: var(--accent);
      color: #111;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 4px 0 rgba(0,0,0,0.08);
    }
    button:hover:not(:disabled) {
      background: #ffd600;
      color: #111;
      box-shadow: 0 4px 12px 0 rgba(0,0,0,0.16);
    }
    .hero, .mission, .shop-item, .gacha-result, .map-button, .upgrade-item {
      background: var(--bg-card);
      padding: 13px 10px;
      border-radius: 12px;
      text-align: center;
      box-shadow: var(--shadow);
      transition: transform 0.15s, box-shadow 0.15s;
    }
    .hero:hover, .mission:hover, .shop-item:hover, .gacha-result:hover, .map-button:hover, .upgrade-item:hover {
      transform: translateY(-3px) scale(1.025);
      box-shadow: 0 4px 16px 0 rgba(0,0,0,0.18);
    }
    .locked { opacity: 0.4; cursor: not-allowed; }
    #log-content {
      max-height: 200px;
      overflow-y: auto;
      background: #181818;
      padding: 10px;
      border-radius: 6px;
      font-size: 0.96em;
      box-shadow: var(--shadow);
    }
    .class { font-weight: bold; display: inline-block; min-width: 65px; }
    .class.tech { color: var(--tech-color); }
    .class.magic { color: var(--magic-color); }
    .class.strength { color: var(--strength-color); }
    .class.speed { color: var(--speed-color); }
    label[for], select, #start-mission, #buy-gacha { margin-top: 10px; }
    @media (max-width: 600px) {
      main { padding: 5px; }
      section { padding: 10px; }
      .grid { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); }
    }
  </style>
</head>
<body>
  <main>
    <header>
      <h1>Idle Superhero Tycoon</h1>
    </header>
    <section aria-labelledby="player-stats-title" id="player-stats">
      <h2 id="player-stats-title">Player Stats</h2>
      <p>Level: <span id="level">1</span></p>
      <p>XP: <span id="xp">0</span> / <span id="xpToLevel">100</span></p>
      <p>Money: $<span id="money">100</span></p>
      <p>Current Map: <span id="currentMap">Map 1</span></p>
      <button class="save-load-btn" id="save-btn" aria-label="Save Game">Save Game</button>
      <button class="save-load-btn" id="load-btn" aria-label="Load Game">Load Game</button>
      <button class="save-load-btn" id="reset-btn" aria-label="Reset Game">Reset</button>
    </section>
    <section aria-labelledby="class-legend-title" id="class-legend">
      <h2 id="class-legend-title">Hero Classes</h2>
      <ul style="display:flex; gap:24px; list-style:none; padding:0; margin:0;">
        <li><span class="class tech" title="Technology heroes excel at gadgets and hacking.">Tech</span></li>
        <li><span class="class magic" title="Magic heroes use spells and arcane arts.">Magic</span></li>
        <li><span class="class strength" title="Strength heroes focus on raw power.">Strength</span></li>
        <li><span class="class speed" title="Speed heroes are quick and agile.">Speed</span></li>
      </ul>
    </section>
    <section aria-labelledby="map-switch-title" id="map-switch">
      <h2 id="map-switch-title">Maps <span aria-label="Unlock maps by leveling up heroes">(Unlock every few hero levels)</span></h2>
      <div class="grid" id="map-buttons"></div>
    </section>
    <section aria-labelledby="heroes-title" id="heroes">
      <h2 id="heroes-title">Owned Heroes</h2>
      <div class="grid" id="heroes-list"></div>
      <p style="margin-top:10px">Total Money Per Second: $<span id="total-mps">0</span></p>
    </section>
    <section aria-labelledby="shop-title" id="shop">
      <h2 id="shop-title">Hero Shop</h2>
      <label for="class-filter">Filter by Class:</label>
      <select id="class-filter" aria-label="Filter heroes by class">
        <option value="">All</option>
        <option value="Tech">Tech</option>
        <option value="Magic">Magic</option>
        <option value="Strength">Strength</option>
        <option value="Speed">Speed</option>
      </select>
      <div class="grid" id="shop-heroes"></div>
    </section>
    <!-- Research Lab Section -->
    <section aria-labelledby="lab-title" id="lab">
      <h2 id="lab-title">Research Lab</h2>
      <div class="grid" id="upgrade-list"></div>
    </section>
    <section aria-labelledby="missions-title" id="missions">
      <h2 id="missions-title">Missions</h2>
      <div class="grid" id="missions-list"></div>
    </section>
    <section aria-labelledby="log-title" id="log">
      <h2 id="log-title">Log</h2>
      <div id="log-content" aria-live="polite"></div>
    </section>
  </main>
  <script>
    // --- Constants and Data ---
    const MAP_COUNT = 15;
    const HERO_COUNT = 50;
    const LEVELS_PER_MAP = 20;
    const mapNames = [
      "Skyline City","Shadow District","Neon Harbor","Crystal Caverns","Ironworks","Solaris Heights","Quantum Quarter",
      "Twilight Outlands","Meteorite Falls","Circuit Spires","Aetherium Isles","Obsidian Expanse","Celestial Park",
      "Echoing Depths","Titan's Reach"
    ];
    const maps = Array.from({length: MAP_COUNT}, (_,i) => ({
      name: mapNames[i],
      unlockLevel: 1 + i * LEVELS_PER_MAP
    }));

    const heroNames = [
      "Blaze", "Frostbite", "Shockwave", "Inferno", "Glacier", "Sandstorm", "Wildwood", "Tsunami", "Voltar", "Blizzard",
      "Cinder", "Echo", "Ironclad", "Stormbreaker", "Phantom", "Nova", "Titan", "Solarflare", "Quake", "Tempest",
      "Shadowstrike", "Glitch", "Aurora", "Ember", "Fang", "Hydra", "Bolt", "Vortex", "Frostfang", "Dune",
      "Gale", "Nightshade", "Tide", "Pulse", "Flare", "Glint", "Blitz", "Shadow", "Cascade", "Steelclaw",
      "Quasar", "Nebula", "Pyro", "Arctic Fox", "Mirage", "Specter", "Solaris", "Cyclone", "Darkwave", "Luminara"
    ];
    while (heroNames.length < HERO_COUNT) heroNames.push("Hero" + (heroNames.length + 1));

    const heroClasses = ["Tech", "Magic", "Strength", "Speed"];
    const heroes = Array.from({length: HERO_COUNT}, (_,i) => ({
      id: i+1,
      name: heroNames[i],
      mps: 1 + Math.floor(Math.random()*10) + i,
      price: 100 + i*50,
      map: maps[Math.floor(i/(HERO_COUNT/MAP_COUNT))].name,
      unlockLevel: 1 + Math.floor(i/(HERO_COUNT/MAP_COUNT)) * LEVELS_PER_MAP,
      class: heroClasses[i % heroClasses.length]
    }));

    // --- Missions (50) ---
    const missionNamesPerMap = [
      ["Stop the Bank Heist", "Rescue the Mayor", "Defuse the Skyscraper Bomb", "Intercept Midnight Robbery", "Save the Runaway Train"],
      ["Infiltrate the Syndicate", "Shadow Alley Chase", "Break the Smuggling Ring", "Decode Secret Messages", "Silent Sabotage"],
      ["Guard the Neon Docks", "Battle the Pirate Crew", "Protect Cargo Ships", "Halt Black Market Deal", "Rescue Hostages at Pier 9"],
      ["Retrieve Crystal Shards", "Defeat the Cave Beast", "Rescue Trapped Miners", "Map the Hidden Passages", "Secure the Cavern Entrance"],
      ["Stop Factory Sabotage", "Rescue Workers", "Shut Down Rogue Machines", "Protect Prototype Tech", "Investigate Explosions"],
      ["Prevent Solar Flare", "Protect the Observatory", "Evacuate Residents", "Apprehend Arsonist", "Restore Power Grid"],
      ["Contain Anomaly", "Rescue Lab Scientists", "Stop Tech Theft", "Seal Quantum Rift", "Hack the Mainframe"],
      ["Patrol the Borderlands", "Rescue Lost Explorers", "Defeat Outland Marauders", "Secure Outpost", "Recover Lost Supplies"],
      ["Investigate Meteor Crash", "Evacuate Impact Zone", "Battle Alien Invaders", "Research Meteor Fragments", "Quarantine Contaminated Area"],
      ["Protect Data Towers", "Chase Cyber Criminals", "Repair Main Circuits", "Install Security Upgrades", "Foil Hacking Attempt"],
      ["Rescue Drifting Ships", "Battle Sky Pirates", "Seal Dimensional Rifts", "Protect Floating Gardens", "Restore Weather Control"],
      ["Track Rogue Mutants", "Secure Resource Convoy", "Defend Outlying Camps", "Investigate Disappearances", "Survey Dangerous Terrain"],
      ["Calm the Rampaging Beast", "Rescue Tourists", "Protect Ancient Relics", "Stop the Park Poachers", "Find Lost Children"],
      ["Explore the Abyss Ruins", "Rescue Divers", "Fight the Abyssal Leviathan", "Secure the Research Sub", "Map the Underwater Tunnels"],
      ["Climb the Titan Spire", "Defeat the Giant Golem", "Rescue the Expedition", "Protect the Mountain Base", "Secure the Ancient Relic"]
    ];
    let missions = [];
    let missionId = 1;
    for (let mapIdx = 0; mapIdx < missionNamesPerMap.length; mapIdx++) {
      for (let i = 0; i < missionNamesPerMap[mapIdx].length; i++) {
        missions.push({
          id: missionId,
          name: missionNamesPerMap[mapIdx][i],
          xpReward: 10 + mapIdx * 5 + i,
          moneyReward: 25 + mapIdx * 10 + i * 3,
          minLevel: 1 + mapIdx * LEVELS_PER_MAP,
          baseDuration: 5 + mapIdx + i
        });
        missionId++;
      }
    }

    // --- Player state ---
    let player = {
      level: 1,
      xp: 0,
      money: 100,
      heroesOwned: [1],
      currentMap: maps[0].name,
      heroMissions: {}, // heroId: {missionId, timeLeft, inProgress}
      incomeBoost: 1,
      missionBoost: 1,
      techBoost: 1,
      magicBoost: 1,
      strengthBoost: 1,
      speedBoost: 1
    };

    // --- UI elements ---
    const levelEl = document.getElementById('level');
    const xpEl = document.getElementById('xp');
    const xpToLevelEl = document.getElementById('xpToLevel');
    const moneyEl = document.getElementById('money');
    const currentMapEl = document.getElementById('currentMap');
    const heroesListEl = document.getElementById('heroes-list');
    const shopHeroesEl = document.getElementById('shop-heroes');
    const missionsListEl = document.getElementById('missions-list');
    const mapButtonsEl = document.getElementById('map-buttons');
    const logContentEl = document.getElementById('log-content');
    const saveBtn = document.getElementById('save-btn');
    const loadBtn = document.getElementById('load-btn');
    const resetBtn = document.getElementById('reset-btn');
    const totalMpsEl = document.getElementById('total-mps');
    const classFilterEl = document.getElementById('class-filter');
    const upgradeListEl = document.getElementById('upgrade-list');

    // --- Research Lab Upgrades ---
    const upgrades = [
      {
        id: 1,
        name: "Boost Hero Income +10%",
        desc: "All heroes earn 10% more money.",
        cost: 500,
        purchased: false,
        apply(player) { player.incomeBoost *= 1.10; }
      },
      {
        id: 2,
        name: "Boost Hero Income +25%",
        desc: "All heroes earn 25% more money.",
        cost: 2500,
        purchased: false,
        apply(player) { player.incomeBoost *= 1.25; }
      },
      {
        id: 3,
        name: "Boost Hero Income +50%",
        desc: "All heroes earn 50% more money.",
        cost: 10000,
        purchased: false,
        apply(player) { player.incomeBoost *= 1.50; }
      },
      {
        id: 4,
        name: "Mission Rewards +20%",
        desc: "Earn 20% more money from missions.",
        cost: 20000,
        purchased: false,
        apply(player) { player.missionBoost *= 1.20; }
      },
      {
        id: 5,
        name: "Tech Class Power",
        desc: "Tech class heroes earn double.",
        cost: 25000,
        purchased: false,
        apply(player) { player.techBoost = 2; }
      },
      {
        id: 6,
        name: "Magic Class Power",
        desc: "Magic class heroes earn double.",
        cost: 25000,
        purchased: false,
        apply(player) { player.magicBoost = 2; }
      },
      {
        id: 7,
        name: "Strength Class Power",
        desc: "Strength class heroes earn double.",
        cost: 25000,
        purchased: false,
        apply(player) { player.strengthBoost = 2; }
      },
      {
        id: 8,
        name: "Speed Class Power",
        desc: "Speed class heroes earn double.",
        cost: 25000,
        purchased: false,
        apply(player) { player.speedBoost = 2; }
      }
    ];

    // --- Utility functions ---
    function addLog(msg) {
      logContentEl.innerHTML = `<div>${msg}</div>` + logContentEl.innerHTML;
    }

    function updatePlayerUI() {
      levelEl.textContent = player.level;
      xpEl.textContent = player.xp;
      xpToLevelEl.textContent = xpToNextLevel(player.level);
      moneyEl.textContent = player.money.toFixed(2);
      currentMapEl.textContent = player.currentMap;
    }

    function updateHeroesUI() {
      heroesListEl.innerHTML = '';
      let totalMps = 0;
      player.heroesOwned.forEach((id) => {
        const hero = heroes.find(h => h.id === id);
        if (!hero) return;
        // Apply per-class boosts:
        let classBoost = 1;
        if (hero.class === "Tech") classBoost = player.techBoost || 1;
        if (hero.class === "Magic") classBoost = player.magicBoost || 1;
        if (hero.class === "Strength") classBoost = player.strengthBoost || 1;
        if (hero.class === "Speed") classBoost = player.speedBoost || 1;
        totalMps += hero.mps * classBoost;
        const div = document.createElement('div');
        div.className = 'hero';
        div.innerHTML = `<strong>${hero.name}</strong><br>
          <span class="class ${hero.class.toLowerCase()}">${hero.class}</span><br>
          Map: ${hero.map}<br>
          MPS: $${(hero.mps * classBoost).toFixed(2)}`;
        heroesListEl.appendChild(div);
      });
      // Apply upgrade boost
      const boost = player.incomeBoost || 1;
      totalMpsEl.textContent = (totalMps * boost).toFixed(2);
    }

    classFilterEl.onchange = updateShopUI;
    function updateShopUI() {
      shopHeroesEl.innerHTML = '';
      const filter = classFilterEl.value;
      const available = heroes.filter(h =>
        h.map === player.currentMap &&
        !player.heroesOwned.includes(h.id) &&
        player.level >= h.unlockLevel &&
        (filter === "" || h.class === filter)
      );
      if (!available.length) {
        shopHeroesEl.textContent = 'No heroes available to buy here.';
        return;
      }
      available.forEach(hero => {
        const div = document.createElement('div');
        div.className = 'shop-item';
        div.innerHTML = `<strong>${hero.name}</strong><br>
          <span class="class ${hero.class.toLowerCase()}">${hero.class}</span><br>
          Price: $${hero.price}<br>
          MPS: $${hero.mps}<br>
          <button ${player.money < hero.price ? 'disabled' : ''}>Buy</button>`;
        div.querySelector('button').onclick = function() {
          if (player.money >= hero.price) {
            player.money -= hero.price;
            player.heroesOwned.push(hero.id);
            addLog(`Bought hero ${hero.name} (${hero.class}) for $${hero.price}`);
            updateAll();
          }
        };
        shopHeroesEl.appendChild(div);
      });
    }

    function updateMapButtonsUI() {
      mapButtonsEl.innerHTML = '';
      maps.forEach(map => {
        const unlocked = player.level >= map.unlockLevel;
        const btn = document.createElement('button');
        btn.textContent = map.name + (unlocked ? '' : ' (Locked)');
        btn.className = 'map-button' + (unlocked ? '' : ' locked');
        btn.disabled = !unlocked;
        btn.onclick = () => {
          if (player.currentMap === map.name) return;
          player.currentMap = map.name;
          addLog(`Switched to map: ${map.name}`);
          updatePlayerUI();
          updateShopUI();
        };
        mapButtonsEl.appendChild(btn);
      });
    }

    function updateMissionsUI() {
      missionsListEl.innerHTML = '';
      player.heroesOwned.forEach(heroId => {
        const hero = heroes.find(h => h.id === heroId);
        const assign = player.heroMissions[heroId] || {};
        const div = document.createElement('div');
        div.className = 'mission';
        // Mission assignment dropdown
        let missionOptions = `<option value="">Assign Mission</option>`;
        missions.forEach(miss => {
          if (player.level >= miss.minLevel) {
            missionOptions += `<option value="${miss.id}" ${assign.missionId==miss.id?'selected':''}>${miss.name}</option>`;
          }
        });
        if (assign.inProgress) {
          div.innerHTML = `<strong>${hero.name}</strong><br>
            <span class="class ${hero.class.toLowerCase()}">${hero.class}</span><br>
            On: ${missions.find(m=>m.id===assign.missionId)?.name || 'Unknown'}<br>
            Time left: <span id="hero-mission-timer-${heroId}">${assign.timeLeft}</span>s<br>
            <button disabled>In Progress</button>`;
        } else {
          div.innerHTML = `<strong>${hero.name}</strong><br>
            <span class="class ${hero.class.toLowerCase()}">${hero.class}</span><br>
            <select class="hero-mission-select" aria-label="Assign mission to ${hero.name}">${missionOptions}</select>
            <button>Start Mission</button>`;
          const select = div.querySelector('.hero-mission-select');
          select.onchange = (e) => {
            assign.missionId = parseInt(e.target.value)||null;
            player.heroMissions[heroId] = assign;
          };
          div.querySelector('button').onclick = () => {
            if (!assign.missionId) {
              alert('Assign a mission first!');
              return;
            }
            assign.inProgress = true;
            const base = missions.find(m=>m.id===assign.missionId);
            assign.timeLeft = base.baseDuration;
            player.heroMissions[heroId] = assign;
            addLog(`${hero.name} started ${base.name}.`);
            updateMissionsUI();
            startHeroMissionTimer(heroId);
          };
        }
        missionsListEl.appendChild(div);
      });
    }

    function updateLabUI() {
      upgradeListEl.innerHTML = '';
      upgrades.forEach(upg => {
        const div = document.createElement('div');
        div.className = 'upgrade-item';
        div.innerHTML = `<strong>${upg.name}</strong><br>
          <span style="font-size:0.95em">${upg.desc}</span><br>
          Cost: $${upg.cost}<br>
          <button ${upg.purchased || player.money < upg.cost ? 'disabled' : ''}>
            ${upg.purchased ? 'Purchased' : 'Buy'}
          </button>`;
        div.querySelector('button').onclick = function() {
          if (player.money >= upg.cost && !upg.purchased) {
            player.money -= upg.cost;
            upg.purchased = true;
            upg.apply(player);
            addLog(`Research purchased: ${upg.name}`);
            updateAll();
          }
        };
        upgradeListEl.appendChild(div);
      });
    }

    function xpToNextLevel(level) {
      return 100 + (level - 1) * 50;
    }

    function updateAll() {
      updatePlayerUI();
      updateHeroesUI();
      updateShopUI();
      updateMapButtonsUI();
      updateMissionsUI();
      updateLabUI();
    }

    // Hero income (idle)
    setInterval(() => {
      let totalMps = 0;
      player.heroesOwned.forEach(id => {
        const hero = heroes.find(h => h.id === id);
        if (!hero) return;
        let classBoost = 1;
        if (hero.class === "Tech") classBoost = player.techBoost || 1;
        if (hero.class === "Magic") classBoost = player.magicBoost || 1;
        if (hero.class === "Strength") classBoost = player.strengthBoost || 1;
        if (hero.class === "Speed") classBoost = player.speedBoost || 1;
        totalMps += hero.mps * classBoost;
      });
      // Apply upgrade boost
      const boost = player.incomeBoost || 1;
      player.money += totalMps * boost / 2;
      moneyEl.textContent = player.money.toFixed(2);
      totalMpsEl.textContent = (totalMps * boost).toFixed(2);
    }, 500);

    function startHeroMissionTimer(heroId) {
      const assign = player.heroMissions[heroId];
      if (!assign || !assign.inProgress) return;
      function tick() {
        if (!assign.inProgress) return;
        assign.timeLeft -= 1;
        const timerSpan = document.getElementById(`hero-mission-timer-${heroId}`);
        if (timerSpan) timerSpan.textContent = assign.timeLeft;
        if (assign.timeLeft <= 0) {
          assign.inProgress = false;
          const base = missions.find(m=>m.id===assign.missionId);
          let missionMoney = base.moneyReward * (player.missionBoost || 1);
          player.money += missionMoney;
          player.xp += base.xpReward;
          addLog(`${heroes.find(h=>h.id===heroId).name} finished ${base.name}! +$${missionMoney.toFixed(2)}, +${base.xpReward} XP`);
          assign.missionId = null;
          checkLevelUp();
          updateAll();
        } else {
          setTimeout(tick, 1000);
        }
      }
      tick();
    }

    function checkLevelUp() {
      let nextLevelXp = xpToNextLevel(player.level);
      while (player.xp >= nextLevelXp) {
        player.xp -= nextLevelXp;
        player.level++;
        addLog(`Level up! Now level ${player.level}`);
        updateMapButtonsUI();
        updateShopUI();
        updateMissionsUI();
        nextLevelXp = xpToNextLevel(player.level);
      }
      updatePlayerUI();
    }

    // Save/load/reset
    saveBtn.onclick = function() {
      localStorage.setItem('idle-superhero-save', JSON.stringify(player));
      addLog('Game saved!');
    };
    loadBtn.onclick = function() {
      const data = localStorage.getItem('idle-superhero-save');
      if (data) {
        Object.assign(player, JSON.parse(data));
        addLog('Game loaded!');
        updateAll();
      } else {
        addLog('No saved game found.');
      }
    };
    resetBtn.onclick = function() {
      if (confirm('Reset your progress?')) {
        localStorage.removeItem('idle-superhero-save');
        location.reload();
      }
    };

    function init() {
      updateAll();
      addLog('Welcome to Idle Superhero Tycoon! Assign each hero to a mission.');
    }
    init();
  </script>
</body>
</html>
