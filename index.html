<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Idle Superhero Tycoon</title>
  <style>
    body { font-family: sans-serif; background: #111; color: white; margin: 0; padding: 0; }
    .container { max-width: 1200px; margin: auto; padding: 20px; }
    h1 { text-align: center; margin-bottom: 10px; }
    .section { margin-top: 30px; background: #222; padding: 20px; border-radius: 10px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
    button { padding: 10px; background: #444; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #666; }
    .hero, .mission, .shop-item, .gacha-result, .map-button { background: #333; padding: 10px; border-radius: 10px; text-align: center; }
    .locked { opacity: 0.4; cursor: not-allowed; }
    #log-content { max-height: 200px; overflow-y: auto; background: #111; padding: 10px; border-radius: 5px; }
    #mission-status { margin-top: 10px; min-height: 24px; }
    select, #start-mission, #buy-gacha { margin-top: 10px; }
    .hero-assignment { margin-top: 10px; }
    .save-load-btn { margin: 5px 10px 5px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Idle Superhero Tycoon</h1>

    <div class="section" id="player-stats">
      <h2>Player Stats</h2>
      <p>Level: <span id="level">1</span></p>
      <p>XP: <span id="xp">0</span> / <span id="xpToLevel">100</span></p>
      <p>Money: $<span id="money">100</span></p>
      <p>Current Map: <span id="currentMap">Map 1</span></p>
      <button class="save-load-btn" id="save-btn">Save Game</button>
      <button class="save-load-btn" id="load-btn">Load Game</button>
      <button class="save-load-btn" id="reset-btn">Reset</button>
    </div>

    <div class="section" id="map-switch">
      <h2>Maps (Unlock every few hero levels)</h2>
      <div class="grid" id="map-buttons"></div>
    </div>

    <div class="section" id="heroes">
      <h2>Owned Heroes</h2>
      <div class="grid" id="heroes-list"></div>
      <p style="margin-top:10px">Total Money Per Second: $<span id="total-mps">0</span></p>
    </div>

    <div class="section" id="shop">
      <h2>Hero Shop</h2>
      <div class="grid" id="shop-heroes"></div>
    </div>

    <div class="section" id="missions">
      <h2>Missions</h2>
      <div class="grid" id="missions-list"></div>
    </div>

    <div class="section" id="log">
      <h2>Log</h2>
      <div id="log-content"></div>
    </div>
  </div>
<script>
  // --- Maps: Unlock every 20 levels ---
  const MAP_COUNT = 15;
  const HERO_COUNT = 50;
  const LEVELS_PER_MAP = 20;
  const maps = Array.from({length: MAP_COUNT}, (_,i) => ({
    name: `Map ${i+1}`,
    unlockLevel: 1 + i * LEVELS_PER_MAP
  }));

  // --- Heroes ---
  const heroNames = [
    "Blaze", "Frostbite", "Shockwave", "Inferno", "Glacier", "Sandstorm", "Wildwood", "Tsunami", "Voltar", "Blizzard",
    "Cinder", "Echo", "Ironclad", "Stormbreaker", "Phantom", "Nova", "Titan", "Solarflare", "Quake", "Tempest",
    "Shadowstrike", "Glitch", "Aurora", "Ember", "Fang", "Hydra", "Bolt", "Vortex", "Frostfang", "Dune",
    "Gale", "Nightshade", "Tide", "Pulse", "Flare", "Glint", "Blitz", "Shadow", "Cascade", "Steelclaw",
    "Quasar", "Nebula", "Pyro", "Arctic Fox", "Mirage", "Specter", "Solaris", "Cyclone", "Darkwave", "Luminara"
  ];
  while (heroNames.length < HERO_COUNT) heroNames.push("Hero"+(heroNames.length+1));
  const heroes = Array.from({length: HERO_COUNT}, (_,i) => ({
    id: i+1,
    name: heroNames[i],
    mps: 1 + Math.floor(Math.random()*10) + i,
    price: 100 + i*50,
    map: maps[Math.floor(i/(HERO_COUNT/MAP_COUNT))].name,
    unlockLevel: 1 + Math.floor(i/(HERO_COUNT/MAP_COUNT)) * LEVELS_PER_MAP
  }));

  // --- Missions (50) ---
  const missionNames = Array.from({length: 50}, (_,i) => `Mission ${i+1}`);
  const missions = Array.from({length: 50}, (_,i) => ({
    id: i+1,
    name: missionNames[i],
    xpReward: 10 + i,
    moneyReward: 20 + i*3,
    minLevel: 1 + Math.floor(i/3),
    baseDuration: 5 + Math.floor(i/5)
  }));

  // --- Player state ---
  let player = {
    level: 1,
    xp: 0,
    money: 100,
    heroesOwned: [1],
    currentMap: maps[0].name,
    heroMissions: {}, // heroId: {missionId, timeLeft, inProgress}
  };

  // --- UI elements ---
  const levelEl = document.getElementById('level');
  const xpEl = document.getElementById('xp');
  const xpToLevelEl = document.getElementById('xpToLevel');
  const moneyEl = document.getElementById('money');
  const currentMapEl = document.getElementById('currentMap');
  const heroesListEl = document.getElementById('heroes-list');
  const shopHeroesEl = document.getElementById('shop-heroes');
  const missionsListEl = document.getElementById('missions-list');
  const mapButtonsEl = document.getElementById('map-buttons');
  const logContentEl = document.getElementById('log-content');
  const saveBtn = document.getElementById('save-btn');
  const loadBtn = document.getElementById('load-btn');
  const resetBtn = document.getElementById('reset-btn');
  const totalMpsEl = document.getElementById('total-mps');

  function xpToNextLevel(level) {
    return 100 + (level - 1) * 50;
  }
  function addLog(text) {
    const p = document.createElement('p');
    p.textContent = text;
    logContentEl.appendChild(p);
    logContentEl.scrollTop = logContentEl.scrollHeight;
  }

  saveBtn.onclick = function() {
    localStorage.setItem('idle-superhero-save', JSON.stringify(player));
    addLog('Game saved!');
  };
  loadBtn.onclick = function() {
    const data = localStorage.getItem('idle-superhero-save');
    if (data) {
      player = JSON.parse(data);
      addLog('Game loaded!');
      updateAll();
    } else addLog('No save found.');
  };
  resetBtn.onclick = function() {
    if (confirm('Reset your progress?')) {
      localStorage.removeItem('idle-superhero-save');
      location.reload();
    }
  };

  function updatePlayerUI() {
    levelEl.textContent = player.level;
    xpEl.textContent = player.xp;
    xpToLevelEl.textContent = xpToNextLevel(player.level);
    moneyEl.textContent = player.money.toFixed(2);
    currentMapEl.textContent = player.currentMap;
  }
  function updateHeroesUI() {
    heroesListEl.innerHTML = '';
    let totalMps = 0;
    player.heroesOwned.forEach((id) => {
      const hero = heroes.find(h => h.id === id);
      if (!hero) return;
      totalMps += hero.mps;
      const div = document.createElement('div');
      div.className = 'hero';
      div.innerHTML = `<strong>${hero.name}</strong><br>
        Map: ${hero.map}<br>
        MPS: $${hero.mps}`;
      heroesListEl.appendChild(div);
    });
    totalMpsEl.textContent = totalMps;
  }
  function updateShopUI() {
    shopHeroesEl.innerHTML = '';
    const available = heroes.filter(h =>
      h.map === player.currentMap &&
      !player.heroesOwned.includes(h.id) &&
      player.level >= h.unlockLevel
    );
    if (!available.length) {
      shopHeroesEl.textContent = 'No heroes available to buy here.';
      return;
    }
    available.forEach(hero => {
      const div = document.createElement('div');
      div.className = 'shop-item';
      div.innerHTML = `<strong>${hero.name}</strong><br>
        Price: $${hero.price}<br>
        MPS: $${hero.mps}<br>
        <button ${player.money < hero.price ? 'disabled' : ''}>Buy</button>`;
      div.querySelector('button').onclick = function() {
        if (player.money >= hero.price) {
          player.money -= hero.price;
          player.heroesOwned.push(hero.id);
          addLog(`Bought hero ${hero.name} for $${hero.price}`);
          updateAll();
        }
      };
      shopHeroesEl.appendChild(div);
    });
  }
  function updateMapButtonsUI() {
    mapButtonsEl.innerHTML = '';
    maps.forEach(map => {
      const unlocked = player.level >= map.unlockLevel;
      const btn = document.createElement('button');
      btn.textContent = map.name + (unlocked ? '' : ' (Locked)');
      btn.className = 'map-button' + (unlocked ? '' : ' locked');
      btn.disabled = !unlocked;
      btn.onclick = () => {
        if (player.currentMap === map.name) return;
        player.currentMap = map.name;
        addLog(`Switched to map: ${map.name}`);
        updatePlayerUI();
        updateShopUI();
      };
      mapButtonsEl.appendChild(btn);
    });
  }

  // --- Missions per hero ---
  function updateMissionsUI() {
    missionsListEl.innerHTML = '';
    player.heroesOwned.forEach(heroId => {
      const hero = heroes.find(h => h.id === heroId);
      const assign = player.heroMissions[heroId] || {};
      const div = document.createElement('div');
      div.className = 'mission';

      // Mission assignment dropdown
      let missionOptions = `<option value="">Assign Mission</option>`;
      missions.forEach(miss => {
        if (player.level >= miss.minLevel) {
          missionOptions += `<option value="${miss.id}" ${assign.missionId==miss.id?'selected':''}>${miss.name}</option>`;
        }
      });

      if (assign.inProgress) {
        div.innerHTML = `<strong>${hero.name}</strong><br>
          On: ${missions.find(m=>m.id===assign.missionId)?.name || 'Unknown'}<br>
          Time left: <span id="hero-mission-timer-${heroId}">${assign.timeLeft}</span>s<br>
          <button disabled>In Progress</button>`;
      } else {
        div.innerHTML = `<strong>${hero.name}</strong><br>
          <select class="hero-mission-select">${missionOptions}</select>
          <button>Start Mission</button>`;
        const select = div.querySelector('.hero-mission-select');
        select.onchange = (e) => {
          assign.missionId = parseInt(e.target.value)||null;
          player.heroMissions[heroId] = assign;
        };
        div.querySelector('button').onclick = () => {
          if (!assign.missionId) {
            alert('Assign a mission first!');
            return;
          }
          assign.inProgress = true;
          const base = missions.find(m=>m.id===assign.missionId);
          assign.timeLeft = base.baseDuration;
          player.heroMissions[heroId] = assign;
          addLog(`${hero.name} started ${base.name}.`);
          updateMissionsUI();
          startHeroMissionTimer(heroId);
        };
      }
      missionsListEl.appendChild(div);
    });
  }

  function updateAll() {
    updatePlayerUI();
    updateHeroesUI();
    updateShopUI();
    updateMapButtonsUI();
    updateMissionsUI();
  }

  // Hero income (idle)
  setInterval(() => {
    let totalMps = 0;
    player.heroesOwned.forEach(id => {
      const hero = heroes.find(h => h.id === id);
      if (hero) totalMps += hero.mps;
    });
    player.money += totalMps / 2;
    moneyEl.textContent = player.money.toFixed(2);
    totalMpsEl.textContent = totalMps;
  }, 500);

  function startHeroMissionTimer(heroId) {
    const assign = player.heroMissions[heroId];
    if (!assign || !assign.inProgress) return;
    function tick() {
      if (!assign.inProgress) return;
      assign.timeLeft -= 1;
      const timerSpan = document.getElementById(`hero-mission-timer-${heroId}`);
      if (timerSpan) timerSpan.textContent = assign.timeLeft;
      if (assign.timeLeft <= 0) {
        assign.inProgress = false;
        const base = missions.find(m=>m.id===assign.missionId);
        player.money += base.moneyReward;
        player.xp += base.xpReward;
        addLog(`${heroes.find(h=>h.id===heroId).name} finished ${base.name}! +$${base.moneyReward}, +${base.xpReward} XP`);
        assign.missionId = null;
        checkLevelUp();
        updateAll();
      } else {
        setTimeout(tick, 1000);
      }
    }
    tick();
  }
  function checkLevelUp() {
    let nextLevelXp = xpToNextLevel(player.level);
    while (player.xp >= nextLevelXp) {
      player.xp -= nextLevelXp;
      player.level++;
      addLog(`Level up! Now level ${player.level}`);
      updateMapButtonsUI();
      updateShopUI();
      updateMissionsUI();
      nextLevelXp = xpToNextLevel(player.level);
    }
    updatePlayerUI();
  }
  function init() {
    updateAll();
    addLog('Welcome to Idle Superhero Tycoon! Assign each hero to a mission.');
  }
  init();
</script>
</body>
</html>
